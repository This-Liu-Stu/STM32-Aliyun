# STM32-Aliyun
STM32使用ESP-01S链接阿里云

## 一、项目概述
本项目基于 STM32F103C8T6 单片机开发，旨在构建一个功能强大的物联网串口服务器 - modbus 网关。通过集成 ESP - 01S 模块实现与阿里云的连接，具备多种总线通信接口（RS232、RS485、CAN）以及无线通信能力（WiFi、4G），能够主动采集串口数据并通过 MQTT 协议透传至阿里云平台，同时支持上位机控制，已完成 Qt、安卓、Python 上位机平台的开发，为物联网应用提供了全面的解决方案。

## 二、硬件设计
1. **硬件开源**：https://oshwhub.com/liubin001/wu-lian-wang-wang-guan-v1-0
1. **核心单片机**：选用 STM32F103C8T6 作为主控制器，其丰富的外设资源和强大的处理能力足以应对本项目的多种任务需求，如串口数据处理、总线通信控制、与无线模块的交互等。
2. **总线接口**：
    - **RS232 接口**：采用标准的 RS232 电平转换电路，实现与具有 RS232 接口的设备进行串口通信，可用于连接一些传统的串口设备，如部分工业传感器、控制器等。
    - **RS485 接口**：配备专门的 RS485 收发器芯片，构建稳定的 RS485 通信链路。RS485 接口支持多节点挂载，适合于工业自动化领域中多个设备之间的组网通信，例如在工厂生产线中连接多个传感器或执行器。
    - **CAN 总线接口**：通过 CAN 控制器和收发器实现 CAN 总线功能。CAN 总线具有高可靠性、实时性强等特点，常用于汽车电子、工业控制等对通信要求较高的领域，本项目中可连接 CAN 总线设备，实现数据的高速传输与交互。
3. **无线通信模块**：采用 ESP - 01S 模块实现 WiFi 连接，支持 2.4GHz 频段的无线网络通信。同时预留 4G 模块接口（可根据实际需求选择合适的 4G 模块进行扩展），通过无线通信模块将采集到的数据传输到阿里云平台，实现设备的远程监控与管理。
4. **显示模块**：选用 0.96 寸 OLED 显示屏，通过 I2C 接口与 STM32 连接。用于显示服务器的基本信息，如设备状态、网络连接情况、当前采集的数据等，方便用户直观了解设备的运行情况。
5. **电源管理**：采用经典的 AMS117 稳压电路，为整个系统提供稳定的电源供应，确保系统在不同的工作条件下都能正常运行，同时具备一定的电源滤波和保护功能，提高系统的稳定性和可靠性。

## 三、软件设计
1. **Modbus 轮询采集**：在软件中实现了 Modbus 协议的轮询功能，能够主动向连接在 RS232、RS485 总线上的 Modbus 设备发送请求，采集设备数据。通过合理设置轮询周期和超时时间，确保数据采集的准确性和及时性，采集到的数据将被进一步处理和传输。
2. **MQTT 透传**：利用 MQTT 协议实现数据的透传功能。将采集到的串口数据按照 MQTT 协议的格式进行封装，并通过 ESP - 01S 模块连接到阿里云平台的 MQTT 服务器，将数据发布到指定的主题（Topic）下。同时，也能够订阅阿里云平台下发的控制指令主题，接收并解析指令，实现对设备的远程控制。
3. **上位机通信**：针对不同的上位机平台（Qt、安卓、Python），开发了相应的通信协议和接口函数。上位机可以通过网络连接到本项目的设备，发送控制指令或接收设备上传的数据。例如，上位机可以发送 Modbus 设备的配置参数，或者获取设备的实时运行数据并进行可视化展示和分析。

## 四、项目功能特性
1. **多总线融合**：集成了 RS232、RS485、CAN 三种常用的总线通信接口，将多种不同类型的设备连接到同一个物联网平台，实现了不同总线设备之间的数据共享和协同工作，提高了系统的兼容性和扩展性。
2. **无线通信灵活选择**：支持 WiFi 和 4G 无线通信方式，用户可以根据实际应用场景选择合适的通信方式。在有稳定 WiFi 网络的环境中，可以使用 WiFi 连接，降低通信成本；在没有 WiFi 覆盖或者需要移动应用的场景下，可以选择 4G 通信，确保设备的远程连接性。
3. **上位机多样化支持**：提供了 Qt、安卓、Python 上位机平台的支持，满足不同用户在不同开发环境和应用需求下的使用。无论是在桌面端进行复杂的设备管理和数据分析，还是在移动端进行便捷的远程监控，都能够得到很好的支持。

## 六、项目应用场景
1. **工业物联网**：在工业自动化生产线上，可连接各种传感器（如温度、压力、流量传感器等）和执行器（如电机、阀门等），实现设备的远程监控、数据采集与分析以及自动化控制。通过阿里云平台的大数据处理能力，可以对生产数据进行深度挖掘，优化生产流程，提高生产效率和产品质量。
2. **智能农业**：用于连接农业大棚内的环境监测设备（如温湿度传感器、光照传感器、土壤湿度传感器等）和灌溉、通风等控制设备。通过手机或电脑上位机，农民可以远程查看大棚内的环境参数，并根据实际情况进行远程控制，实现智能灌溉、智能通风等功能，提高农业生产的精细化管理水平。
3. **智能家居**：可作为智能家居系统的核心控制单元，连接家庭中的各种智能设备（如智能门锁、智能窗帘、智能家电等），实现家庭设备的互联互通和远程控制。用户可以通过手机 APP（安卓上位机）或电脑软件（Qt 上位机）对家庭设备进行集中管理和控制，打造舒适、便捷、智能的家居生活环境。

## 七、总结与展望
本 STM32 - Aliyun 项目通过整合多种硬件接口和软件功能，实现了一个功能完备、应用广泛的物联网串口服务器 - modbus 网关。在未来的发展中，将继续优化软件性能，提高系统的稳定性和可靠性；进一步拓展与阿里云平台其他服务的集成，如数据分析服务、人工智能服务等，为用户提供更具价值的物联网解决方案；同时，关注物联网技术的发展趋势，适时引入新的技术和功能，如低功耗蓝牙通信、边缘计算等，不断提升项目的竞争力和创新性。 